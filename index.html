<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EcoTap üå±</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(120deg, #a3e635, #4ade80, #22c55e);
      background-size: 400% 400%;
      animation: gradientFlow 12s ease infinite;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #fff;
      user-select: none;
      overflow: hidden;
    }
    @keyframes gradientFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .game-container {
      text-align: center;
      padding: 20px;
      max-width: 400px;
      width: 100%;
      position: relative;
      z-index: 2;
    }
    .stats-panel {
      background: rgba(0,0,0,0.3);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
    }
    .stat-item {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      font-size: 18px;
    }
    .energy-bar {
      width: 100%;
      height: 20px;
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
      overflow: hidden;
      margin: 10px 0;
    }
    .energy-fill {
      height: 100%;
      background: linear-gradient(90deg,#3b82f6,#1d4ed8);
      transition: width 0.3s ease;
    }
    #tapButton {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      border: none;
      background: radial-gradient(circle at 30% 30%, #16a34a, #065f46);
      box-shadow: 0 10px 25px rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      cursor: pointer;
      transition: transform 0.1s ease;
      position: relative;
      overflow: hidden;
      z-index: 3;
    }
    #tapButton:active { transform: scale(0.95); }
    .ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(255,255,255,0.5);
      transform: scale(0);
      animation: rippleAnim 0.8s ease-out forwards;
      pointer-events: none;
    }
    @keyframes rippleAnim {
      to { transform: scale(2.5); opacity: 0; }
    }
    .droplet {
      position: absolute;
      font-size: 18px;
      animation: dropAnim 1s ease-out forwards;
      pointer-events: none;
    }
    @keyframes dropAnim {
      to { transform: translateY(60px) scale(0.5); opacity: 0; }
    }
    .tree-animation {
      position: absolute;
      width: 120px;
      height: 120px;
      background-image: url('https://cdn-icons-png.flaticon.com/512/765/765521.png');
      background-size: contain;
      background-repeat: no-repeat;
      left: 50%;
      top: 20%;
      transform: translate(-50%, -50%) scale(0);
      opacity: 0;
      transition: transform 0.8s ease-out, opacity 0.8s ease-out;
      z-index: 1;
    }
    .leaf {
      position: fixed;
      top: -50px;
      font-size: 24px;
      opacity: 0.8;
      animation: fall linear forwards;
      z-index: 1;
    }
    @keyframes fall {
      to {
        transform: translateY(110vh) rotate(360deg);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div class="game-container">
    <div class="stats-panel">
      <div class="stat-item"><span>üí∞ Points:</span><span id="points">0</span></div>
      <div class="stat-item"><span>üå≥ Trees:</span><span id="trees">0</span></div>
      <div class="stat-item"><span>‚≠ê Level:</span><span id="level">1</span></div>
      <div class="stat-item"><span>‚ö° Energy:</span><span id="energy">100/100</span></div>
      <div class="energy-bar"><div class="energy-fill" id="energyBar"></div></div>
    </div>
    <button id="tapButton">üíß</button>
    <div id="statusMessage"></div>
  </div>

  <script>
    const API_BASE = 'https://representations-pray-setting-foot.trycloudflare.com';

    let gameState = { points:0, trees:0, level:1, energy:100 };
    let userId = Math.floor(Math.random()*1000000);
    let firstTap = true;

    function updateUI() {
      document.getElementById('points').textContent = gameState.points;
      document.getElementById('trees').textContent = gameState.trees;
      document.getElementById('level').textContent = gameState.level;
      document.getElementById('energy').textContent = `${gameState.energy}/100`;
      document.getElementById('energyBar').style.width = `${gameState.energy}%`;
    }

    function animateTap(x,y) {
      const btn = document.getElementById('tapButton');
      const rect = btn.getBoundingClientRect();
      const ripple = document.createElement('div');
      ripple.className='ripple';
      const size = Math.max(rect.width,rect.height);
      ripple.style.width=ripple.style.height=`${size}px`;
      ripple.style.left=`${x-rect.left-size/2}px`;
      ripple.style.top=`${y-rect.top-size/2}px`;
      btn.appendChild(ripple);
      setTimeout(()=>ripple.remove(),800);
      for (let i=0;i<4;i++){
        const drop=document.createElement('div');
        drop.className='droplet';
        drop.style.left=`${x+(Math.random()*40-20)}px`;
        drop.style.top=`${y+(Math.random()*40-20)}px`;
        drop.textContent="üíß";
        document.body.appendChild(drop);
        setTimeout(()=>drop.remove(),1000);
      }
    }

    function showTreeAnimation(){
      const tree=document.createElement('div');
      tree.className='tree-animation';
      document.body.appendChild(tree);
      setTimeout(()=>{tree.style.transform='translate(-50%,-50%) scale(1)';tree.style.opacity='1';},50);
      setTimeout(()=>tree.remove(),2000);
    }

    function createLeaf() {
      const leaf = document.createElement('div');
      leaf.className = 'leaf';
      leaf.textContent = 'üçÇ';
      leaf.style.left = Math.random() * window.innerWidth + 'px';
      leaf.style.animationDuration = (4 + Math.random()*4) + 's';
      document.body.appendChild(leaf);
      setTimeout(()=>leaf.remove(),8000);
    }
    setInterval(createLeaf, 1500);

    document.getElementById('tapButton').addEventListener('click',(e)=>{
      if(firstTap){ e.target.textContent="üå±"; firstTap=false; showTreeAnimation(); }
      animateTap(e.clientX,e.clientY);
      fetch(`${API_BASE}/api/tap`,{
        method:"POST",headers:{"Content-Type":"application/json"},
        body:JSON.stringify({user_id:userId,taps:1})
      }).then(r=>r.json()).then(d=>{gameState=d;updateUI();})
      .catch(err=>console.log("Tap error:",err));
    });

    updateUI();
  </script>
</body>
</html>
